<!-- ribborn -->
<section class="bg-white ribbon">
    <div class="bg-white container">
        <div style="border-bottom: 1px solid #d2d2d7;" class="row ">
            <div class="pt-3 bg-white ribbon-covid-19 col-md-4 col-4">
                <p class="text-center shipping-ribbon-text">Checkout </p>
            </div>
            <div class="pt-3 bg-white ribbon-covid-19 col-md-8 col-8">

            </div>
        </div>
    </div>
</section>

<section class="bg-white">
    <div class="container">
        <div class="row">
            <div class="col-md-12 ">
                <div class="bag-header">
                    <div class="mt-5 rs-bag-header">
                        <h2 class="shipping-header-text checkout-header-text imac-header-text ">Where should we send
                            your order?</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="form">
    <form action="" id="shipping-details" method="POST">
        <section class="mt-5">
            <div class="container">
                <div class="shipping-address-container">
                    <h3 class="shipping-address-text">Select an address:</h3>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label class="mt-3 poduct-container col-md-12 p-0 ">
                            <input type="radio" onclick="hideAddressForm()" class="radio-btn" id="address-option"
                                name="addressOption" value="defaultAddress" required>
                            <div class="device-model-select product-model">
                                <div class="device-radio">
                                     <span class="device-price-right">Default</span>
                                    <span class="model-title">Clevin Wilson</span>
                                    <span class="screen-size pb-3 ">{{user.address.street}}</span>
                                   
                                </div>
                            </div>
                        </label>

                        {{#if addressError}}

                        <div class="edit-address">
                            <a style="font-size: 15px; color: red; " data-toggle="modal" data-target="#defaultAddress"
                                class="content-align" href="#">Edit this address</a>
                        </div>
                        {{else}}
                        <div class="edit-address">
                            <a style="font-size: 15px; color: #267af7; " data-toggle="modal"
                                data-target="#defaultAddress" class="content-align" href="#">Edit this address</a>
                        </div>
                        {{/if}}


                    </div>
                    <div class="col-md-6">

                    </div>
                </div>

                <div class="row">
                    <di class="col-md-6">
                        <label class="mt-3 poduct-container col-md-12 p-0 ">
                            <input type="radio" onclick="showAddressForm()" class="radio-btn" id="addressOption"
                                name="addressOption" value="newAddress" required>
                            <div class="device-model-select product-model">
                                <div class="device-radio p-2">
                                    <span class="model-title">Use a new address</span>
                                </div>
                            </div>
                        </label>
                    </di>
                    <div class="col-md-6">

                    </div>
                </div>

                <div style="display: none;" id="newAddress" class="row">
                    <div class="col-md-6">
                        <div class="email">
                            <input style="border-radius: 10px;" type="text"
                                class="mt-3 form-input-padding form-control" id="firstName" name="firstName"
                                placeholder="First Name" required>
                        </div>
                        <div class="number ">
                            <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                                id="lastName" name="lastName" placeholder="Last Name" required>
                        </div>
                        <div class="address1 ">
                            <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                                id="street" name="street" placeholder="Address Line 1"
                                autocomplete="address-level1" required>
                        </div>
                        <div class="address2 ">
                            <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                                id="street2" name="street2" placeholder="Address Line 2 (Optional)"
                                autocomplete="address-level2">
                        </div>
                        <div class="landmark ">
                            <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                                id="street3" name="street3" placeholder="Landmark (Optional)"
                                autocomplete="address-level3">
                        </div>
                        <div class="postalCode ">
                            <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                                id="postalCode" name="postalCode" placeholder="PIN Code" autocomplete
                                required>
                        </div>
                        <div class="cityState ">
                            <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                                id="cityState" name="state" placeholder="City, State" required>
                        </div>
                        <div class="country ">
                            <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                                id="country" name="country" placeholder="Country" value="India" readonly required>
                        </div>
                       
                    </div>
                    <div class="col-md-6">

                    </div>
                </div>
            </div>
        </section>


        <section class="mt-5">
            <div class="container">
                <div class="shipping-address-container">
                    <h3 class="shipping-address-text">What’s your contact information?</h3>
                </div>

                <div style="    border-bottom: 1px solid #d2d2d7;" class="row">
                    <div class="col-md-6 mb-5">
                        <div class="email">
                            <input style="border-radius: 10px;" type="email"
                                class="mt-3 form-input-padding form-control" id="email" name="email"
                                placeholder="Email Address" value="{{user.email}}" required>
                        </div>
                        <div class="number ">
                            <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                                id="number" name="number" value="{{user.number}}" placeholder="India Mobile Number"
                                required>
                        </div>
                         <input type="text" name="userId" value="{{user._id}}" hidden>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="message ml-3 mt-3">
                            <h5 class="shipping-message">For a successful delivery, make sure your phone number is
                                correct:</h5>
                            <ul>
                                <li style="font-size: 13px;">The courier will send a One-Time Password (OTP) to this number.</li>
                                <li style="font-size: 13px;">We’ll email you a receipt and send order updates to your mobile phone via SMS or iMessage.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row mb-5">
                    <div class="col-md-6">
                        <div class="bottem-checkout-btn-container ">
                            <a onclick="placeOrder()"
                                class="text-white col-md-12 btn btn-primary bottem-shipping-btn checkout-btn mt-4 ">Continue
                                to
                                Payment</a>
                        </div>
                    </div>
                    <div class="col-md-6">

                    </div>
                </div>
            </div>
        </section>
    </form>
</div>

<!-- default address Modal-->
<div class="modal fade" id="defaultAddress" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div style="    margin-top: 30px;" class="text-center modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: black;" class="modal-title text-black " id="exampleModalLabel">Edit Address</h2>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <form action="/add-default-address" method="POST">
            <div class="col-md-12 p-3">
                <div class="email">
                    <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                        id="firstName" name="firstName" value="{{user.address.firstName}}" placeholder="First Name" required>
                </div>
                <div class="number ">
                    <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                        id="lastName" name="lastName" value="{{user.address.lastName}}" placeholder="Last Name" required>
                </div>
                <div class="address1 ">
                    <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                        id="street" name="street" value="{{user.address.street}}" placeholder="Address Line 1" autocomplete="address-level1"
                        required>
                </div>
                <div class="address2 ">
                    <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                        id="street2" name="street2" value="{{user.address.street2}}" placeholder="Address Line 2 (Optional)"
                        autocomplete="address-level2">
                </div>
                <div class="landmark ">
                    <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                        id="street3" name="street3" value="{{user.address.street3}}" placeholder="Landmark (Optional)"
                        autocomplete="address-level3">
                </div>
                <div class="postalCode ">
                    <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                        id="postalCode" name="postalCode" value="{{user.address.postalCode}}" placeholder="PIN Code" autocomplete required>
                </div>
                <div class="cityState ">
                    <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                        id="cityState" name="state" value="{{user.address.state}}" placeholder="City, State" required>
                </div>
                <div class="country ">
                    <input style="border-radius: 10px;" type="text" class="mt-3 form-input-padding form-control"
                        id="country" name="country" placeholder="Country" value="India" readonly required>
                </div>
                <input type="text" name="userId" value="{{user._id}}" hidden>
            </div>

            <div class="bottem-checkout-btn-container col-md-12 p-3  ">
                <button type="submit" id="submit" 
                    class="text-white col-md-12 btn btn-primary bottem-shipping-btn checkout-btn mb-4  ">Save
                    Changes</button>
            </div>
            </form>
        </div>
    </div>
</div>


<style>
    .poduct-container input:checked~.device-model-select {
        border-color: #2196F3;
        border-width: 2px;
    }

    #navbar.mySidenav {
        position: absolute !important;
    }

    .radio-btn {
        position: absolute;
        opacity: 0;
        cursor: pointer;
    }
</style>

<script>
    function showAddressForm() {
        document.getElementById('newAddress').style.display = 'block'
    }

    function hideAddressForm() {
        document.getElementById('newAddress').style.display = 'none'
    }
</script>


<script>

    function placeOrder() {
        $.ajax({
            url: '/place-order',
            data: $("#shipping-details").serialize(),
            method: "post",
            success: function (response) {
                if (response) {
                    razorpayPayment(response)
                } else {
                    window.location.reload()
                }
            }

        })


    }

    function razorpayPayment(order) {
        var options = {
            "key": "rzp_test_deE2E1795zFmxy", // Enter the Key ID generated from the Dashboard
            "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
            "currency": "INR",
            "name": "Apple",
            "description": "Test Transaction",
            "image": "https://cdn.razorpay.com/logos/I19mkV5YVbyhC3_original.png",
            "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
            "handler": function (response) {
                verifyPayment(response, order)
            },
            "prefill": {
                "name": "{{user.firstname}}",
                "email": "{{user.email}}",
                "contact": "{{user.number}}"
            },
            "notes": {
                "address": "Razorpay Corporate Office"
            },
            "theme": {
                "color": "#141414"
            }
        };
        var rzp1 = new Razorpay(options);
        rzp1.open();
    }


    function verifyPayment(payment, order) {
        $.ajax({
            url: '/verify-payment',
            data: {
                payment,
                order
            },
            method: 'post',
            success: (response) => {
                if (response.status) {
                    window.location.href = "/order"
                } else {
                    alert('Payment Failed');
                }
            }
        })
    }




</script>